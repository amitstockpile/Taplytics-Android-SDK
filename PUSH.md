Setting up Push Notifications using Taplytics is simple. Follow the steps below to get started.

|#  |Step                                                                       |
|---|---                                                                        |
|1  |  Setup: [Android Studio](#android-studio), [Eclipse](#eclipse)            |
|2  | [Receiving Push Notifications](#2-receiving-push-notifications)            |
|3  | [Retreiving Custom Push Data](#3-retreiving-custom-push-data)             |
|4  | [Setting a Custom Push Intent](#4-setting-custom-push-intent)             |
|5  | [Tracking Push Notification Opens](#5-tracking-push-notification-opens)                             |
|6  | [Resetting Users](#6-resetting-users)

## 1. Setup

### Android Studio

If you wish to use Push Notifications on Taplytics, you must add the following permissions (replace `com.yourpackagename` with your app's package name) to your Android Manifest:

```xml
<uses-permission android:name="com.google.android.c2dm.permission.RECEIVE" />
<permission android:name="com.yourpackagename.permission.C2D_MESSAGE"/>
<uses-permission android:name="com.yourpackagename.permission.C2D_MESSAGE" />
<uses-permission android:name="android.permission.WAKE_LOCK" />
```
And you must add the following receiver and service under your application tag:

```xml
<receiver
    android:name="com.taplytics.sdk.TLGcmBroadcastReceiver"
    android:permission="com.google.android.c2dm.permission.SEND" >
    <intent-filter>
        <action android:name="com.google.android.c2dm.intent.RECEIVE" />
    </intent-filter>
</receiver>
<service android:name="com.taplytics.sdk.TLGcmIntentService" />
```

---

### Eclipse

An extra step is needed for Push Notifications in Eclipse. You must add the Google Play Services library to your project's dependencies. 

To do so, follow the steps in the following link. Click on the `Using Android Studio` dropdown and choose `Using Eclipse with ADT`.

[See how to set up GooglePlay Services on developer.android.com](http://developer.android.com/google/play-services/setup.html).

Once Google Play Services is added to your application in Eclipse, follow the steps [listed above](#android-studio) to get started with Push on Android with Taplytics!

---

## 2. Receiving Push Notifications

To send your users Push Notifications, we'll need you to upload your Google Cloud Messaging credentials. Please follow [this guide](https://taplytics.com/docs/guides/push-notifications/google-push-certificates) to do so.

### Activity Routing

By default, when a notification sent by Taplytics is clicked, it will open up the main activity of the application. However, you may want to route your users to a different Activity. This can be done on the Taplytics Push page.

Simply add a custom data value to the push with the key `tl_activity` and with the **full** (_including package name_) class name of your activity. For example:


![image](https://s3.amazonaws.com/cdn.taplytics.com/Images/push_custom_data.png)

### Push Title

By default, the title of a push notification will be the application name. 

Currently, the best way to change the title of a push notification is to add a `tl_title` custom key. For Example:

![image](https://s3.amazonaws.com/cdn.taplytics.com/Images/push_custom_data_2.png)

### Getting the Push Token
Sometimes, it can be useful to have the actual token generated by GCM, to target pushes at specific users.

To get this token, use the following method:

```java
        Taplytics.setTaplyticsPushTokenListener(new TaplyticsPushTokenListener() {
            @Override
            public void pushTokenReceived(String token) {
             //Do something with the push token here.
            }
        });
```

---

## 3. Retreiving Custom Push Data

On the push dashboard, custom data can be entered into push notifications. To receive this data, you can use a PushNotificationListener. 

```java
Taplytics.addPushNotificationListener(new TaplyticsPushNotificationListener() {
            @Override
            public void pushReceived(JSONObject customData) throws JSONException {
                //There it is!
            }
        });
```

You can add as many PushNotificationListeners in your application as you would like. To remove them, simply save a reference to the PushNotificationListener and call `Taplytics.removePushNotificationListener`. 

## 4. Setting Custom Push Intent

To further customize the push notification intent, a ```PushNotificationIntentListener``` can be used to supply an entirely new intent to be used by the push notification. This listener is triggered when a push notification is being built, so the custom data from the Taplytics dashboard can be used in the new intent if needed.  

```java
Taplytics.setPushNotificationIntentListener(new TaplyticsPushNotificationIntentListener() {
            @Override
            public Intent setPushNotificationIntent(JSONObject customData) throws JSONException {
               //return your own custom intent (CustomData is the custom keys from the dashboard)
            }
        });                
```

## 5. Tracking Push Notification Opens

By default, Taplytics will automatically track push notification opens. However, if this information is needed elsewhere, a `TaplyticsPushOpenedListener` can be used to track a push being opened.


```java
        Taplytics.addPushNotificationOpenedListener(new TaplyticsPushOpenedListener() {
            @Override
            public void pushOpened(Bundle bundle) {
                //The push has been opened. Bundle is the extras associated with the intent. 
            }
        });
```

Note: If the push notification is opened while currently on the page that the push notification opens, it will not be tracked. Also, if the push notification doesn't open an activity, or if it opens an application other than the one building the notification, this cannot be tracked. 


## 6. Resetting Users

Sometimes, it may be useful to reset an app user for push notifications. For instance, if a user is logged out in your app, you may want them to stop receiving push notifications. If you wish to turn off push notifications for an app user, it can be done as such:

```java
TaplyticsResetUserListener listener = new TaplyticsResetUserListener() {
  @Override
  public void finishedResettingUser() {
    // Do stuff
  }
};

Taplytics.resetAppUser(listener);
```

Now, the device that the app is currently running on will no longer receive push notifications until the app user attributes are updated again.
